{% extends 'layout_configuration.html' %}
{% block content %}
<div class="container mt-4">
    <div class="row">
        <!-- Liste des utilisateurs -->
        <div class="col-md-6">
            <h4>Utilisateurs existants</h4>
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Nom</th>
                        <th>Code</th>
                        <th>Mode de vente</th>
                        <th>Profil</th>
                        <th>Clavier</th>
                        <th>Imprimante</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for utilisateur in utilisateurs %}
                    <tr>
                        <td>{{ utilisateur.nom }}</td>
                        <td>{{ utilisateur.code }}</td>
                        <td>{{ utilisateur.mode_vente }}</td>
                        <td>{{ utilisateur.profil.nom if utilisateur.profil }}</td>
                        <td>{{ utilisateur.clavier.nom if utilisateur.clavier }}</td>
                        <td>{{ utilisateur.imprimante.nom if utilisateur.imprimante }}</td>
                        <td>
                            <a href="{{ url_for('configuration.configuration_utilisateurs') }}?edit_id={{ utilisateur.id }}" class="btn btn-sm btn-warning">Modifier</a>
                            <a href="{{ url_for('configuration.delete_utilisateur', id=utilisateur.id) }}" class="btn btn-sm btn-danger">Supprimer</a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- Formulaire -->
        <div class="col-md-6">
            <h4>{{ 'Modifier' if edit_utilisateur else 'Ajouter' }} un utilisateur</h4>
            <form method="post" action="{{ url_for('configuration.save_utilisateur') }}">
                <input type="hidden" name="id" value="{{ edit_utilisateur.id if edit_utilisateur else '' }}">

                <div class="form-group">
                    <label for="nom">Nom :</label>
                    <input type="text" class="form-control" name="nom" value="{{ edit_utilisateur.nom if edit_utilisateur else '' }}" required>
                </div>

                <div class="form-group">
                    <label for="code">Code :</label>
                    <input type="text" class="form-control" name="code" value="{{ edit_utilisateur.code if edit_utilisateur else '' }}">
                </div>

                <div class="form-group">
                    <label for="mode_vente">Mode de vente :</label>
                    <select class="form-control" name="mode_vente">
                        <option value="ticket" {% if edit_utilisateur and edit_utilisateur.mode_vente == 'ticket' %}selected{% endif %}>Ticket</option>
                        <option value="table" {% if edit_utilisateur and edit_utilisateur.mode_vente == 'table' %}selected{% endif %}>Table</option>
                        <option value="compte" {% if edit_utilisateur and edit_utilisateur.mode_vente == 'compte' %}selected{% endif %}>Compte</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="profil_id">Profil :</label>
                    <select class="form-control" name="profil_id">
                        <option value="">-- Choisir --</option>
                        {% for profil in profils %}
                        <option value="{{ profil.id }}" {% if edit_utilisateur and edit_utilisateur.profil_id == profil.id %}selected{% endif %}>{{ profil.nom }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="form-group">
                    <label for="clavier_id">Clavier :</label>
                    <select class="form-control" name="clavier_id">
                        <option value="">-- Choisir --</option>
                        {% for clavier in claviers %}
                        <option value="{{ clavier.id }}" {% if edit_utilisateur and edit_utilisateur.clavier_id == clavier.id %}selected{% endif %}>{{ clavier.nom }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="form-group">
                    <label for="imprimante_id">Imprimante :</label>
                    <select class="form-control" name="imprimante_id">
                        <option value="">-- Choisir --</option>
                        {% for imprimante in imprimantes %}
                        <option value="{{ imprimante.id }}" {% if edit_utilisateur and edit_utilisateur.imprimante_id == imprimante.id %}selected{% endif %}>{{ imprimante.nom }}</option>
                        {% endfor %}
                    </select>
                </div>

                <button type="submit" class="btn btn-success mt-2">Enregistrer</button>
            </form>
        </div>
    </div>
</div>
{% endblock %}
