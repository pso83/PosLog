<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Programmation des articles</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light p-4">
<div class="container-fluid">
  <h2 class="mb-4">Programmation des articles</h2>
  <div class="row">
    <!-- Liste des articles -->
    <div class="col-md-6">
      <div class="card">
        <div class="card-header bg-dark text-white">Articles enregistrés</div>
        <div class="card-body" style="max-height: 600px; overflow-y: auto;">
          <table class="table table-sm table-striped">
            <thead>
              <tr>
                <th>Nom</th>
                <th>Prix 1</th>
                <th>TVA</th>
                <th></th>
              </tr>
            </thead>
            <tbody>
              {% for article in articles %}
              <tr>
                <td>{{ article.nom_article }}</td>
                <td>{{ article.prix_1 }} €</td>
                <td>{{ article.tva_id }}</td>
                <td>
                  <a href="/programmer/articles?id={{ article.id }}" class="btn btn-sm btn-primary">Modifier</a>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Formulaire d'ajout/modif -->
    <div class="col-md-6">
      <div class="card">
        <div class="card-header bg-secondary text-white">
          {% if article %}Modifier l’article{% else %}Ajouter un article{% endif %}
        </div>
        <div class="card-body">
          <form method="post" action="/programmer/articles/save">
            {% if article %}
              <input type="hidden" name="id" value="{{ article.id }}">
            {% endif %}
            <div class="mb-3">
              <label class="form-label">Nom de l'article</label>
              <input type="text" class="form-control" name="nom_article" value="{{ article.nom_article if article else '' }}">
            </div>
            <div class="row">
              <div class="col"><label class="form-label">Prix 1</label><input type="number" step="0.01" class="form-control" name="prix_1" value="{{ article.prix_1 if article else '' }}"></div>
              <div class="col"><label class="form-label">Prix 2</label><input type="number" step="0.01" class="form-control" name="prix_2" value="{{ article.prix_2 if article else '' }}"></div>
            </div>
            <div class="row mt-2">
              <div class="col"><label class="form-label">Prix 3</label><input type="number" step="0.01" class="form-control" name="prix_3" value="{{ article.prix_3 if article else '' }}"></div>
              <div class="col"><label class="form-label">Prix 4</label><input type="number" step="0.01" class="form-control" name="prix_4" value="{{ article.prix_4 if article else '' }}"></div>
            </div>
            <div class="mt-3">
              <label class="form-label">TVA</label>
              <select class="form-select" name="tva_id">
                {% for taux in tva_options %}
                  <option value="{{ taux }}" {% if article and article.tva_id == taux|string %}selected{% endif %}>{{ taux }}%</option>
                {% endfor %}
              </select>
            </div>
            <hr>
            <div class="row">
              {% set flags = ['prix_manuel', 'vendu_au_poids', 'avec_code_barre', 'eligible_fidelite',
                              'retour_autorise', 'avoir_autorise', 'gere_stock', 'vendu_en_negatif',
                              'hors_ca', 'est_menu', 'est_formule', 'composant_menu', 'composant_formulaire',
                              'appel_commentaire', 'imprimable_preparation', 'invisible_telecommande',
                              'vente_a_distance', 'gere_heure', 'depot_vente', 'gere_sav'] %}
              {% for flag in flags %}
                <div class="col-6">
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="{{ flag }}" name="{{ flag }}" {% if article and article[flag] %}checked{% endif %}>
                    <label class="form-check-label" for="{{ flag }}">{{ flag.replace('_', ' ')|capitalize }}</label>
                  </div>
                </div>
              {% endfor %}
            </div>
            <div class="mt-4">
              <button type="submit" class="btn btn-success">Enregistrer</button>
              <a href="/programmer" class="btn btn-secondary ms-2">Retour</a>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
</body>
</html>
